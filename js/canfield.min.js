"use strict";function Start(bs){K.start(bs);ck(K.ba);$("#stock").on("click",ci);$(options.src).on(options.evt,".card:last-child",cg);$("#game, #again").on("click",cf);$("#hint").on("click",cj);$("#undo").on("click",cm);$("#tool, #list").on("click",ch);$("body").on("contextmenu",cy);$(document).on("keyup",function(n){n.which===113?cf():n.which===72?cj():n.which===90?n.ctrlKey&&cm():(n.which===13||n.which===32)&&$("#win").is(":visible")&&cf()}).on("keydown",function(n){n.which===32&&n.preventDefault()});cq()}function cy(n){var bp,t,i,bu;for(cw(),K.bh(),bp=null,t=null,i=0;i<K.bo.length;i++)if(bp=K.bo[i],bp.aa!=="draw"){if(!bp.ae.ax())if(K.id==="MonteCarlo"){if(bp.az[0]!=="t")continue}else if(K.id==="Pyramid"){if(bp.az[0]!=="t")continue}else continue;t=bp;break}return t===null?!1:(bu=K.ca(t.aa,t.az,t.ae.id),cd(bu),cy(n),!1)}function cu(){try{try{$(".ui-draggable").draggable("destroy")}catch(n){}try{$(".drop").droppable("destroy")}catch(n){}}catch(t){}$("body").css("cursor","auto")}function ci(){K.bk();ck(K.ba);cq()}function co(n,t){var aa=t.draggable[0].id,az=$("#"+aa).parent().attr("id"),bu=K.ca(aa,az,this.id);cd(bu)}function cp(){if(options.dad!==""){var n={containment:"#solitaire",cursor:"move",revert:!0,opacity:1.7,revertDuration:"fast",helper:function(){var n=$(this),af=n.nextAll().addBack(),t=$("<div/>").append(af.clone()).css("margin-top",n.css("margin-top")).css("margin-left",n.css("margin-left"));return af.addClass("hide"),t},start:function(n,t){t.helper.css("z-index",1);var i={hoverClass:"hovered",tolerance:options.mod,drop:co};$(".drop").droppable(i)},stop:function(n,t){t.helper.css("z-index",0);$(".card").removeClass("hide")}};$(options.dad).draggable(n)}}function cq(){$(".dialog").hide();cp();cl();var ce=K.ce();ce!==0&&($("#win h3").hide(),ce>0&&$("#win .win").show(),ce<0&&$("#win .lost").show(),$("#win").show(),$("#overlay").show(),setTimeout(function(){$("#overlay").hide()},1e3))}function cs(ca){var n=K.bw(ca.az);ck([n]);ck([ca.ae])}function cd(bu){if(bu.length!==0){cu();for(var n=0;n<bu.length;n++)cs(bu[n]);cq()}}function cf(){K.count<10?(K.start(),ck(K.ba),cq()):location.reload()}function cg(n,aa){aa||(aa=this.id);var az=$("#"+aa).parent().attr("id"),bu=K.ca(aa,az,options.dst);cd(bu)}function ch(){$(".dialog").hide();var cz=$("#run");cz.show()}function cj(){var bp;for(cw();L.length>0;)clearTimeout(L.pop());if($(".hint").removeClass("hint"),$("#zombie").remove(),bp=K.bl(),bp!==null){var i=500,t=1500,aa=bp.aa,n=bp.ae;n.id==="stock"?(i-=500,t-=500):$("#"+aa).addClass("hint");n.id==="waste"?t-=500:n.aw()?$("#"+n.id).append("<div id='zombie' class='card hint space'>"):(aa=n.ak().ap,L.push(setTimeout(function(){$("#"+aa).addClass("hint")},i)));L.push(setTimeout(function(){$(".hint").removeClass("hint");$("#zombie").remove()},t))}}function ck(ba){for(var ar,n=0;n<ba.length;n++)ba[n]!==null&&($("#"+ba[n].id+" .card").remove(),$("#"+ba[n].id).append(ba[n].ad()));K.bg!==null&&(ar=K.bg===9?"10":E[K.bg][0],$(".drop .draw div").text(ar))}function cl(){var t=K.bj()?"+":"Ã—",n;$("#stock .draw div").text(t);n=K.be.af.length;K.id==="AcesUp"&&(n/=4);n<6&&n>0&&$(".count .card:last-child").html("<div>"+n.toString()+"<\/div>")}function cm(){cd(K.ct())}function cw(){K.bf!==null&&(K.bf.ae.ak().ao=!1,ck([K.bf.ae]),K.bf=null)}var E=["Ace","2","3","4","5","6","7","8","9","10","Jack","Queen","King"],F=["Hearts","Spades","Diamonds","Clubs"],G=0,H=1,I=2,J=3,A=function(){function A(aa,az,ae){this.aa=aa;this.az=az;this.ae=ae}return A}(),B=function(){function B(n){this.id=n;this.ar=n%13;this.at=Math.floor(n/13);this.ay=this.at===G||this.at===I;this.au=!this.ay;this.ai=!1;this.ao=!1;this.ap=F[this.at][0]+(this.ar===9?"T":E[this.ar][0]);this.html="<div id='"+this.ap+"' class='card down'><\/div>"}return B.prototype.aq=function(){return this.ar===0},B.prototype.as=function(){return this.ar===12},B.prototype.ad=function(){var n=this.html;return this.ao&&(n=n.replace(" down"," down selected")),this.ai&&(n=n.replace(" down"," up")),n},B.prototype.toString=function(){return E[this.ar]+" "+F[this.at]},B}(),C=function(){function C(){this.af=[];for(var n=0;n<52;n++)this.af[n]=new B(n);for(n=0;n<this.af.length;n++)this.af[n]=this.af.splice(Math.floor(this.af.length*Math.random()),1,this.af[n])[0]}return C.prototype.ag=function(n){return n>this.af.length&&(n=this.af.length),this.af.splice(0,n)},C}(),D=function(){function D(ah,af,n){this.ah=ah;this.af=af;this.id=n;this.aj=-1}return D.prototype.ak=function(){return this.af[this.af.length-1]},D.prototype.al=function(aa){for(var n=0;n<this.af.length;n++)if(this.af[n].ap===aa)return n;return-1},D.prototype.am=function(){for(var n=0;n<this.af.length;n++)if(this.af[n].ai)return n;return-1},D.prototype.aw=function(){return this.af.length===0},D.prototype.ax=function(){return this.id[0]==="f"},D.prototype.ac=function(){return this.id[0]==="r"},D.prototype.av=function(){return this.id[0]==="s"},D.prototype.ab=function(){return this.id[0]==="t"},D.prototype.an=function(){return this.id[0]==="w"},D.prototype.ad=function(){var r="",i=this.aj,n,t;for(i<0&&(i=this.af.length),n=this.af.length-i,n<0&&(n=0),t=n;t<this.af.length;t++)r+=this.af[t].ad();return r},D.prototype.toString=function(){return this.id},D}(),T=function(){function T(){this.ba=[];this.bz=null;this.be=null;this.br=null;this.bt=[];this.by=[];this.bu=[];this.bi=!1;this.bo=null;this.bp=-1;this.bq=!0;this.id="Canfield";this.bs=1;this.count=0;this.bd=!0;this.bf=null;this.bg=null}return T.prototype.bh=function(){var n,t,r,u,aa,i,e,f,af,o;for(this.bo=[],this.bp=-1,i=this.bm(),e=i.length,n=0;n<e;n++)for(aa=i[n].ak().ap,t=0;t<this.by.length;t++)if(this.bb(aa,i[n].id,this.by[t].id)){this.bo.push(new A(aa,i[n].id,this.by[t]));break}for(f=[],n=0;n<e;n++)for(af=this.getCards(i[n]),r=0;r<af.length;r++)for(aa=af[r].ap,t=0;t<this.bt.length;t++)if(this.bb(aa,i[n].id,this.bt[t].id)){for(o=!1,u=0;u<this.bo.length;u++)if(this.bo[u].az===this.bt[t].id&&this.bo[u].ae.id===i[n].id){o=!0;break}o||(r===0?this.bo.push(new A(aa,i[n].id,this.bt[t])):f.push(new A(aa,i[n].id,this.bt[t])))}f.length>0&&(this.bo=this.bo.concat(f));this.bo.length===0&&this.bj()&&this.bo.push(new A("draw",this.be.id,this.be));this.bq=this.bo.length!==0},T.prototype.bj=function(){return this.id==="Cruel"||this.id==="MonteCarlo"?!this.bd:this.be&&this.be.af.length>0?!0:this.br&&this.br.af.length>0?!0:!1},T.prototype.ag=function(bs){var t=function(ah){var n=null;switch(ah){case 11:break;case 0:n="stock";break;case 1:n="waste";break;case 2:n="reserve";break;case 3:case 4:case 5:case 6:n="f"+(ah-3).toString();break;default:n="t"+(ah-7).toString()}return n},n;for(this.cz(t),this.by[0].af=this.be.af.splice(0,1),this.by[0].af[0].ai=!0,this.bg=this.by[0].af[0].ar,n=0;n<this.bt.length;n++)this.bt[n].af=this.be.af.splice(0,1),this.bt[n].af[0].ai=!0;this.bz.af=this.be.af.splice(0,13);this.bz.af[12].ai=!0;bs||(bs=this.bs);this.bs=bs;this.br.aj=3;this.bk()},T.prototype.bk=function(){var n,t;if(this.be.aw()){if(!this.br.aw()){for(this.cr("list",null,null);!this.br.aw();)n=this.br.af.pop(),n.ai=!1,this.be.af.push(n),this.cr(n.ap,this.br.id,this.be),this.cr(n.ap,this.be.id,null);this.cr("list",null,null)}}else{for(this.bs!==1&&this.cr("list",null,null),t=0;t<this.bs;t++)this.be.aw()||(n=this.be.af.pop(),this.br.af.push(n),this.cr(n.ap,this.be.id,this.br),n.ai=!0,this.cr(n.ap,this.br.id,null));this.bs!==1&&this.cr("list",null,null)}this.bd=!0;this.bh()},T.prototype.getCards=function(ae){var t=ae.af.length,i=t-1,r=[],n;for(this.id==="Yukon"&&(i=ae.am()),n=i;n<t;n++)r.push(ae.af[n]);return r},T.prototype.bl=function(){return(this.bo===null&&this.bh(),!this.bq)?null:(this.bp++,this.bp===this.bo.length&&(this.bp=0),this.bo[this.bp])},T.prototype.bm=function(){var n=this.bt.filter(function(n){return!n.aw()}),t=this.id==="Cruel";return n.sort(function(n,i){var r=i.af.length-n.af.length;return t&&(r=i.ak().ar-n.ak().ar),r===0&&(r=n.ah-i.ah),r}),this.id==="Pyramid"&&this.br.af.length>0&&n.push(this.br),this.id==="Canfield"&&this.br.af.length>0&&n.push(this.br),this.id==="Canfield"&&this.bz.af.length>0&&n.push(this.bz),n},T.prototype.bw=function(n){for(var t=0;t<this.ba.length;t++)if(this.ba[t].id===n)return this.ba[t];return null},T.prototype.bb=function(aa,az,n){var u,i;if(this.bi)return!0;if(az===n)return!1;var r=this.bw(az),f=r.al(aa),t=r.af[f];return t.ai?r.ab()&&f!==0&&f!==r.af.length-1?!1:(u=this.bw(n),i=u.ak(),u.ab())?u.aw()?r.ac()?!0:this.bz.aw()?!0:!1:t.ay===i.ay?!1:t.ar===i.ar-1?!0:t.as()&&i.aq():u.ax()?aa!==r.ak().ap?!1:u.aw()?t.ar===this.bg:t.at!==i.at?!1:t.ar===i.ar+1?!0:t.aq()&&i.as():!1:!1},T.prototype.ca=function(aa,az,n){var u=["f0","f1","f2","f3"],t,r,i,bu;for(n!=="?"&&(u=[n]),t=0;t<u.length;t++){if(n=u[t],this.bb(aa,az,n))break;n=""}if(n==="")return[];var f=this.bw(az),e=this.bw(n),o=f.al(aa),af=f.af.splice(o);for(t=0;t<af.length;t++)e.af.push(af[t]);return this.bd=!1,r=null,this.bi||(i=f.ak(),i&&!i.ai&&(i.ai=!0,r=i.ap)),bu=[this.cr(aa,az,e)],r&&bu.push(this.cr(r,az,null)),bu},T.prototype.cz=function(n){for(var r=new C,i,t=0;t<99;t++){if(i=n(t),i===null)break;this.ba[t]=new D(t,[],i)}for(this.bt=[],this.by=[],t=0;t<this.ba.length;t++)switch(this.ba[t].id[0]){case"r":this.bz=this.ba[t];break;case"s":this.be=this.ba[t];break;case"w":this.br=this.ba[t];break;case"t":this.bt.push(this.ba[t]);break;case"f":this.by.push(this.ba[t])}this.be||(this.be=new D(99,[],""));this.be.af=r.ag(99);this.bu=[];this.bo=null},T.prototype.start=function(bs){for(var ce=-1;ce===-1;)this.ag(bs),ce=this.ce();this.count++},T.prototype.ce=function(){var n=this.by.reduce(function(n,t){return n+t.af.length},0);return n===52?1:n===48&&this.id==="AcesUp"?1:(n=this.bt.reduce(function(n,t){return n+t.af.length},0),n===0&&this.id==="Golf")?1:n===0&&this.id==="Pyramid"?1:(this.bh(),!this.bq)?-1:0},T.prototype.cr=function(aa,az,ae){this.bo=null;var ca=new A(aa,az,ae);return this.bi||this.bu.push(ca),ca},T.prototype.ct=function(){var n,t,i,r,u,bu;if(this.bu.length===0)return[];n=this.bu[this.bu.length-1];t=0;n.aa==="list"?(t=99999,n=this.bu.pop()):t=n.ae===null?2:1;i=[];this.bi=!0;do n=this.bu.pop(),n.aa==="list"?t=0:n.ae===null?(r=this.bw(n.az),u=r.al(n.aa),r.af[u].ai=!r.af[u].ai,i.push(n)):(bu=this.ca(n.aa,n.ae.id,n.az),i.push(bu[0])),t--;while(t>0);return this.bi=!1,i},T}(),K=new T,L=[],options={evt:"dblclick",src:"#tableaux, #waste",dst:"?",dad:"#plateaux .up:last-child, #tableaux .up:last-child, #tableaux .up:first-child",mod:"pointer"}